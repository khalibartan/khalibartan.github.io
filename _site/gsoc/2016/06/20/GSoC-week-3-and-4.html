<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Google Summer of Code week 3 and 4</title>
  <meta name="description" content="In terms of progress week 3 turned to be dull. I was having doubts in my mind regarding the representation since start of coding period and somehow I always ...">

  <!-- CSS files -->
  <link rel="stylesheet" href="http://khalibartan.github.io/css/font-awesome.min.css">
  <link rel="stylesheet" href="http://khalibartan.github.io/css/main.css">

  <link rel="canonical" href="http://khalibartan.github.io/gsoc/2016/06/20/GSoC-week-3-and-4.html">
  <link rel="alternate" type="application/rss+xml" title="utkarsh's blog" href="http://khalibartan.github.io/feed.xml" />
  <link href='../feed.xml' rel='alterante' type='application/rss+xml'>
</head>

<body>
  <nav class="post-navigation" role="navigation">
  <div class="row">
    <div class="col s5">
      <div class="post-nav-prev">
        
        <a href="http://khalibartan.github.io/gsoc/2016/06/08/GSoC-week-2.html" title="Google Summer of Code week 2">
          <div class="post-nav-btn">
            <div class="post-nav-text"><span class="danger-text-color"><i class="fa fa-angle-left"></i> ~ </span><span class="hidden-md primary-text-color">Google Summer of Code week 2</span></div>
          </div>
        </a>
        
      </div>
    </div>
    <div class="col s2">
      <a href="http://khalibartan.github.io/">
        <div class="leonids-icon">
          <i class="fa fa-home"></i>
        </div>
      </a>
    </div>
    <div class="col s5 right">
      <div class="post-nav-next">
        
      </div>
    </div>
  </div>
</nav>

  

<div class="container">
  <div id="post">
    <header class="post-header">
      <h1 title="Google Summer of Code week 3 and 4">Google Summer of Code week 3 and 4</h1>
      <span class="post-meta">
        <span class="post-date">
          20 JUN 2016
        </span>
        •
        <span class="read-time" title="Estimated read time">
  
  
    6 mins read
  
</span>

      </span>

    </header>

    <article class="post-content">
      
      <p>In terms of progress week 3 turned to be dull. I was having doubts in my mind regarding the representation since start of 
coding period and somehow I always forgot to have my doubts cleared in meeting. 
I wasted a lot of time reading theory to help me out with this doubt of mine and till mid of the week 4 it remained unclear.</p>

<p>During week 3, I re-structured my code in different parts. Remove the <code class="highlighter-rouge">BaseHamiltonianMC</code> and created a <code class="highlighter-rouge">HamiltonianMC</code> class which 
returned samples using Simple Hamiltonian Monte Carlo. This class was then inherited by <code class="highlighter-rouge">HamiltonianMCda</code> 
which returned samples using Simple Hamiltonian Monte Carlo. Wrote function for some section of overlapping code, 
changed name of some parameters to specify their context in a better manner. 
Apart from that I was experimenting a bit with the API and how samples should be returned.</p>

<p>As discussed in last post, the parameterization of model was still unclear to me, 
but upon discussion with my mentor and other members I found that we already had a representation finalized 
for Continuous factor and Joint distributions. I wasted a lot of time on this matter, I laughed at my silly mistake. 
If I had my doubts clear in start I would have already finished with my work. No frets now it gave me a good learning experience. 
So I re-wrote my certain part of code to take this parameterization into account. In discussion of week 4 meeting upon my 
suggestion we decided to use <code class="highlighter-rouge">numpy.recarray</code> objects instead of <code class="highlighter-rouge">pandas.DataFrame</code> as <code class="highlighter-rouge">pandas.DataFrame</code> was adding a 
dependency and was also slower than <code class="highlighter-rouge">numpy.recarray</code> objects. I also improved the documentation of my code during the week 4, 
which earlier wasn’t consistent with my examples. I was allowing user to pass any n-dimensional array 
instead of mentioned 1d array in documentation, I thought it will provide more flexibility but actually it was making things ambiguous. 
At the end of week 4 the code looks really different from what it was in the start. I wrote <code class="highlighter-rouge">_sample</code> method which run a 
single iteration of sampling using Hamiltonian Monte Carlo. Now the code returns samples in two different types. 
If user has an installation of pandas, it returns <code class="highlighter-rouge">pandas.DataFrame</code> otherwise it returns <code class="highlighter-rouge">numpy.recarry</code> object. 
This is how output looks like now:</p>

<ul>
  <li>If user doesn’t have a installation of pandas in environment</li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">pgmpy.inference.continuous</span> <span class="kn">import</span> <span class="n">HamiltonianMC</span> <span class="k">as</span> <span class="n">HMC</span><span class="p">,</span> <span class="n">LeapFrog</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">pgmpy.models</span> <span class="kn">import</span> <span class="n">JointGaussianDistribution</span> <span class="k">as</span> <span class="n">JGD</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">covariance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">3</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.7</span><span class="p">,</span> <span class="mi">5</span><span class="p">]])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">model</span> <span class="o">=</span> <span class="n">JGD</span><span class="p">([</span><span class="s">'x'</span><span class="p">,</span> <span class="s">'y'</span><span class="p">],</span> <span class="n">mean</span><span class="p">,</span> <span class="n">covariance</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">sampler</span> <span class="o">=</span> <span class="n">HMC</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">grad_log_pdf</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">simulate_dynamics</span><span class="o">=</span><span class="n">LeapFrog</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">samples</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">initial_pos</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">num_samples</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>
<span class="o">...</span>                          <span class="n">trajectory_length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">stepsize</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">samples</span>
<span class="n">array</span><span class="p">([(</span><span class="mf">5e-324</span><span class="p">,</span> <span class="mf">5e-324</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mf">2.2348941964735225</span><span class="p">,</span> <span class="mf">4.43066330647519</span><span class="p">),</span>
       <span class="p">(</span><span class="o">-</span><span class="mf">2.316454719617516</span><span class="p">,</span> <span class="mf">7.430291195678112</span><span class="p">),</span> <span class="o">...</span><span class="p">,</span>
       <span class="p">(</span><span class="o">-</span><span class="mf">1.1443831048872348</span><span class="p">,</span> <span class="mf">3.573135519428842</span><span class="p">),</span>
       <span class="p">(</span><span class="o">-</span><span class="mf">0.2325915892988598</span><span class="p">,</span> <span class="mf">4.155961788010201</span><span class="p">),</span>
       <span class="p">(</span><span class="o">-</span><span class="mf">0.7582492446601238</span><span class="p">,</span> <span class="mf">3.5416519297297056</span><span class="p">)],</span> 
      <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s">'x'</span><span class="p">,</span> <span class="s">'&lt;f8'</span><span class="p">),</span> <span class="p">(</span><span class="s">'y'</span><span class="p">,</span> <span class="s">'&lt;f8'</span><span class="p">)])</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">samples</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span> <span class="k">for</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">variables</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>
<span class="n">array</span><span class="p">([[</span> <span class="mf">3.0352818</span> <span class="p">,</span>  <span class="mf">0.71379304</span><span class="p">],</span>
       <span class="p">[</span> <span class="mf">0.71379304</span><span class="p">,</span>  <span class="mf">4.91776713</span><span class="p">]])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">sampler</span><span class="o">.</span><span class="n">accepted_proposals</span>
<span class="mf">9932.0</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">sampler</span><span class="o">.</span><span class="n">acceptance_rate</span>
<span class="mf">0.9932</span>
</code></pre>
</div>

<ul>
  <li>If user has a pandas installation</li>
</ul>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">pgmpy.inference.continuous</span> <span class="kn">import</span> <span class="n">HamiltonianMC</span> <span class="k">as</span> <span class="n">HMC</span><span class="p">,</span> <span class="n">GradLogPDFGaussian</span><span class="p">,</span> <span class="n">ModifiedEuler</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">pgmpy.models</span> <span class="kn">import</span> <span class="n">JointGaussianDistribution</span> <span class="k">as</span> <span class="n">JGD</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">covariance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">model</span> <span class="o">=</span> <span class="n">JGD</span><span class="p">([</span><span class="s">'x'</span><span class="p">,</span> <span class="s">'y'</span><span class="p">],</span> <span class="n">mean</span><span class="p">,</span> <span class="n">covariance</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">sampler</span> <span class="o">=</span> <span class="n">HMC</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">samples</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">num_samples</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
<span class="o">...</span>                          <span class="n">trajectory_length</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">stepsize</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">samples</span>
               <span class="n">x</span>              <span class="n">y</span>
<span class="mi">0</span>  <span class="mf">4.940656e-324</span>  <span class="mf">4.940656e-324</span>
<span class="mi">1</span>   <span class="mf">1.592133e+00</span>   <span class="mf">1.152911e+00</span>
<span class="mi">2</span>   <span class="mf">1.608700e+00</span>   <span class="mf">1.315349e+00</span>
<span class="mi">3</span>   <span class="mf">1.608700e+00</span>   <span class="mf">1.315349e+00</span>
<span class="mi">4</span>   <span class="mf">6.843856e-01</span>   <span class="mf">6.237043e-01</span>
</code></pre>
</div>

<p>In contrast to earlier output which was just a list of numpy.array objects</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">pgmpy.inference.continuous</span> <span class="kn">import</span> <span class="n">HamiltonianMC</span> <span class="k">as</span> <span class="n">HMC</span><span class="p">,</span> <span class="n">GradLogPDFGaussian</span><span class="p">,</span> <span class="n">ModifiedEuler</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">pgmpy.models</span> <span class="kn">import</span> <span class="n">JointGaussianDistribution</span> <span class="k">as</span> <span class="n">JGD</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">covariance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">model</span> <span class="o">=</span> <span class="n">JGD</span><span class="p">([</span><span class="s">'x'</span><span class="p">,</span> <span class="s">'y'</span><span class="p">],</span> <span class="n">mean</span><span class="p">,</span> <span class="n">covariance</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">sampler</span> <span class="o">=</span> <span class="n">HMC</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">grad_log_pdf</span><span class="o">=</span><span class="n">GradLogPDFGaussian</span><span class="p">,</span> <span class="n">simulate_dynamics</span><span class="o">=</span><span class="n">ModifiedEuler</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">samples</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">num_samples</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
<span class="o">...</span>                          <span class="n">trajectory_length</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">stepsize</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">samples</span>
<span class="p">[</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">]]),</span>
 <span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">]]),</span>
 <span class="n">array</span><span class="p">([[</span> <span class="mf">0.62270104</span><span class="p">],</span>
        <span class="p">[</span> <span class="mf">1.04366093</span><span class="p">]]),</span>
 <span class="n">array</span><span class="p">([[</span> <span class="mf">0.97897949</span><span class="p">],</span>
        <span class="p">[</span> <span class="mf">1.41753311</span><span class="p">]]),</span>
 <span class="n">array</span><span class="p">([[</span> <span class="mf">1.48938348</span><span class="p">],</span>
        <span class="p">[</span> <span class="mf">1.32887231</span><span class="p">]])]</span>
</code></pre>
</div>

<p>Next week I’ll try to do some changes mentioned by my mentor on my PR. Also I’ll write more test cases to individually
test each function instead of testing the overall implementation. After my PR gets merged I’ll try to write introductory blogs
related to Markov Chain Monte Carlo and Hamiltonian Monte Carlo and will work on No U Turn Sampling.</p>

    </article>
  </div>

  <div class="share-buttons">
    <h6>Share on: </h6>
    <ul>
      <li>
        <a href="https://twitter.com/intent/tweet?text=http://khalibartan.github.io/gsoc/2016/06/20/GSoC-week-3-and-4.html" class="twitter btn" title="Share on Twitter"><i class="fa fa-twitter"></i><span> Twitter</span></a>
      </li>
      <li>
        <a href="https://www.facebook.com/sharer/sharer.php?u=http://khalibartan.github.io/gsoc/2016/06/20/GSoC-week-3-and-4.html" class="facebook btn" title="Share on Facebook"><i class="fa fa-facebook"></i><span> Facebook</span></a>
      </li>
      <li>
        <a href="https://plus.google.com/share?url=http://khalibartan.github.io/gsoc/2016/06/20/GSoC-week-3-and-4.html" class="google-plus btn" title="Share on Google Plus"><i class="fa fa-google-plus"></i><span> Google+</span></a>
      </li>
      <li>
        <a href="https://news.ycombinator.com/submitlink?u=http://khalibartan.github.io/gsoc/2016/06/20/GSoC-week-3-and-4.html" class="hacker-news btn" title="Share on Hacker News"><i class="fa fa-hacker-news"></i><span> Hacker News</span></a>
      </li>
      <li>
        <a href="https://www.reddit.com/submit?url=http://khalibartan.github.io/gsoc/2016/06/20/GSoC-week-3-and-4.html" class="reddit btn" title="Share on Reddit"><i class="fa fa-reddit"></i><span> Reddit</span></a>
      </li>
    </ul>
  </div><!-- end share-buttons -->

  
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'utgup';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

  
</div>

  <footer>
  &copy; 2016 Utkarsh Gupta
</footer>

  <script type="text/javascript" src="http://khalibartan.github.io/js/jquery-2.1.4.min.js"></script>
<script type="text/javascript" src="http://khalibartan.github.io/js/jquery.fitvids.js"></script>
<script type="text/javascript" src="http://khalibartan.github.io/js/main.js"></script>


</body>
</html>
